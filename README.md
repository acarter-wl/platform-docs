# Platform Documentation

Centralized documentation hub aggregating docs from multiple repositories into a single searchable site.

## Overview

This repository powers the documentation site at `https://acarter-wl.github.io/platform-docs/`. It aggregates documentation from multiple source repositories while keeping docs close to the code they document.

### Architecture

```
Source Repos                Platform Docs              Output
┌────────────┐             ┌──────────────┐          ┌─────────────┐
│ plt-modules│             │              │          │             │
│   /docs/   │────────────▶│  Aggregation │─────────▶│  MkDocs     │
└────────────┘             │    Script    │          │  Material   │
                           │              │          │   Site      │
┌────────────┐             │  (GitHub     │          │             │
│infrastructure            │   Actions)   │          │  (GitHub    │
│   /docs/   │────────────▶│              │─────────▶│   Pages)    │
└────────────┘             └──────────────┘          └─────────────┘
                                  ▲
┌────────────┐                    │
│ service-n  │                    │
│   /docs/   │────────────────────┘
└────────────┘
```

**How it works:**
1. Each service repo maintains its own `docs/` folder
2. GitHub Actions runs every 4 hours (or on-demand)
3. Aggregation script clones repos and copies docs
4. MkDocs builds unified site with search
5. Deploys to GitHub Pages automatically

## Quick Start

### Prerequisites

- Python 3.11+
- Git
- GitHub Personal Access Token (for private repos)

### Local Development

1. **Clone this repository**
   ```bash
   git clone https://github.com/acarter-wl/platform-docs.git
   cd platform-docs
   ```

2. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Set GitHub token (for private repos)**
   ```bash
   export GITHUB_TOKEN=ghp_your_token_here
   ```

4. **Aggregate documentation**
   ```bash
   python scripts/aggregate-docs.py
   ```

5. **Preview locally**
   ```bash
   mkdocs serve
   ```
   Open http://localhost:8000 in your browser

### Testing Changes

Before pushing configuration changes, test locally:

```bash
# Test aggregation
python scripts/aggregate-docs.py --config repos-config.yaml

# Test build
mkdocs build --strict

# Preview
mkdocs serve
```

## Configuration

### Adding a New Repository

Edit `repos-config.yaml`:

```yaml
repos:
  - repo: acarter-wl/your-service-name
    docs_path: docs                    # Path to docs in source repo
    target_path: services/service-name # Where to place in platform-docs
    enabled: true                      # Set to false to disable
    description: Brief service description
```

Then commit and push. GitHub Actions will pick it up on the next run.

### Repository Structure Requirements

Each source repository should have a `docs/` folder:

```
your-service/
├── src/
├── README.md
└── docs/
    ├── index.md          # Required: Overview page
    ├── architecture.md
    ├── api/
    │   └── endpoints.md
    └── runbooks/
        └── incident.md
```

**Best practices:**
- Always include `index.md` as the landing page
- Use clear folder structure
- Follow markdown best practices
- Include diagrams (Mermaid supported)
- Link to code using relative paths

## GitHub Actions Workflow

### Automatic Runs

- **Schedule:** Every 4 hours
- **Trigger:** Push to `repos-config.yaml`, workflow file, or aggregation script
- **Manual:** Via "Actions" tab → "Aggregate and Deploy Documentation" → "Run workflow"

### Workflow Steps

1. Checkout platform-docs repository
2. Install Python dependencies
3. Run aggregation script (clones repos, copies docs)
4. Commit aggregated docs to `docs/services/`
5. Build MkDocs site
6. Deploy to GitHub Pages

### Required Secrets

**DOCS_PAT**: GitHub Personal Access Token with `repo` scope

⚠️ **Important**: For private repositories (like TheVault), you **must** configure a Personal Access Token.

See **[GITHUB_ACTIONS_SETUP.md](GITHUB_ACTIONS_SETUP.md)** for detailed setup instructions.

**Quick Setup**:
1. Create a PAT: https://github.com/settings/tokens
2. Grant `repo` scope
3. Add as secret: Repository Settings → Secrets → Actions → New secret
4. Name: `DOCS_PAT`
5. Value: Your token

If not provided, workflow uses `GITHUB_TOKEN` (public repos only).

## Project Structure

```
platform-docs/
├── .github/
│   └── workflows/
│       └── aggregate-docs.yml    # CI/CD workflow
├── docs/
│   ├── index.md                  # Homepage
│   ├── platform/                 # Platform team docs
│   │   ├── architecture/
│   │   ├── runbooks/
│   │   └── how-to/
│   └── services/                 # Auto-aggregated service docs
│       ├── plt-modules/          # (Generated by workflow)
│       └── infrastructure/       # (Generated by workflow)
├── scripts/
│   └── aggregate-docs.py         # Aggregation logic
├── .gitignore
├── mkdocs.yml                    # MkDocs configuration
├── repos-config.yaml             # Repository list
├── requirements.txt              # Python dependencies
└── README.md                     # This file
```

## Documentation Standards

### Writing Guide

- Use clear, concise language
- Include code examples
- Add diagrams for complex concepts
- Link to related documentation
- Update docs when changing code

### Doc Types

| Type | Purpose | Template |
|------|---------|----------|
| **Architecture** | High-level design, ADRs | docs/platform/architecture/ |
| **Runbooks** | Incident response, operations | docs/platform/runbooks/ |
| **How-To** | Step-by-step guides | docs/platform/how-to/ |
| **API Docs** | Endpoint documentation | docs/services/{service}/api/ |

### Markdown Features

MkDocs Material supports:

- **Admonitions** (notes, warnings, tips)
- **Code blocks** with syntax highlighting
- **Mermaid diagrams**
- **Tables**
- **Task lists**
- **Footnotes**
- **Emoji** :rocket:

See [MkDocs Material docs](https://squidfunk.github.io/mkdocs-material/) for full feature list.

## Port.io Integration (Future)

While this POC focuses on MkDocs aggregation, future Port.io integration will add:

1. **Service Catalog Links**
   - Link from Port.io service entities to MkDocs docs
   - Add `docsUrl` property to service blueprint

2. **README Sync**
   - Port.io displays README.md in entity tabs
   - Full docs available via MkDocs link

3. **Discoverability**
   - Port.io = "What services exist?"
   - MkDocs = "How does it work?"

## AI Documentation Generation (Future)

This architecture supports AI-generated documentation:

1. **Standard structure** makes prompting easy
2. **CI/CD integration** can trigger AI generation
3. **Review process** ensures quality
4. **Incremental updates** via scheduled runs

## Troubleshooting

### Aggregation fails

```bash
# Check repo access
git clone https://github.com/acarter-wl/repo-name

# Verify token
echo $GITHUB_TOKEN

# Test locally
python scripts/aggregate-docs.py --config repos-config.yaml
```

### Build fails

```bash
# Check for markdown errors
mkdocs build --strict

# Validate YAML
python -c "import yaml; yaml.safe_load(open('mkdocs.yml'))"
```

### Docs not updating

- Check Actions tab for workflow status
- Verify `repos-config.yaml` has correct repo paths
- Ensure source repo has `docs/` folder
- Check if repo is `enabled: true`

## Contributing

### Adding Platform Docs

Platform-level documentation (architecture, runbooks, how-tos) lives directly in this repo:

1. Create markdown files in appropriate `docs/platform/` subfolder
2. Update `mkdocs.yml` navigation
3. Test locally with `mkdocs serve`
4. Commit and push

### Adding Service Docs

Service documentation lives in the service repository:

1. Create `docs/` folder in service repo
2. Add markdown files (start with `index.md`)
3. Add service to `repos-config.yaml` in platform-docs
4. Wait for next aggregation run (or trigger manually)

## Support

- **Issues:** https://github.com/acarter-wl/platform-docs/issues

## License

MIT License - Austin Carter
